import {
  ChangeEvent,
  FunctionComponent,
  useEffect,
  useRef,
  useState,
} from "react";
import { toLatin, toUniCode, toDecimal } from "./util";

import {
  checkBox,
  encodedStrCSS,
  encodingInput,
  label,
  wrapper,
} from "./style";

type encoding = "Unicode" | "Latin" | "Decimal";

export const Encoder: FunctionComponent = () => {
  const [encodedStr, setEncodedStr] = useState("Encoded Data here");
  const [encodeTo, setEncodeTo] = useState<encoding>("Unicode");
  const inputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    if (!inputRef.current) return;
    if (encodeTo === "Latin") {
      const encodedData = toLatin(inputRef.current.value);
      setEncodedStr(encodedData);
      return;
    }
    if (encodeTo === "Unicode") {
      const encodedData = toUniCode(inputRef.current.value);
      setEncodedStr(encodedData);
    }
    if (encodeTo === "Decimal") {
      const encodedData = toDecimal(inputRef.current.value);
      setEncodedStr(encodedData);
    }
  }, [encodeTo]);

  const onChangeFunc = (e: ChangeEvent<HTMLInputElement>) => {
    if (encodeTo === "Latin") {
      const encodedData = toLatin(e.target.value);
      setEncodedStr(encodedData);
      return;
    }
    if (encodeTo === "Unicode") {
      const encodedData = toUniCode(e.target.value);
      setEncodedStr(encodedData);
      return;
    }
    if (encodeTo === "Decimal") {
      const encodedData = toDecimal(e.target.value);
      setEncodedStr(encodedData);
    }
  };

  return (
    <div css={wrapper}>
      <h2>encoder</h2>
      <input
        css={encodingInput}
        defaultValue="Type"
        onChange={onChangeFunc}
        ref={inputRef}
      />
      <div>
        <label css={label} htmlFor="Unicode">
          <input
            css={checkBox}
            type="radio"
            name="encoding"
            id="Unicode"
            onChange={e => {
              if (e.target.checked === true) setEncodeTo("Unicode");
            }}
          />
          UniCode
        </label>
      </div>

      <label css={label} htmlFor="Latin">
        <input
          css={checkBox}
          type="radio"
          name="encoding"
          id="Latin"
          onChange={e => {
            if (e.target.checked === true) setEncodeTo("Latin");
          }}
        />
        Latin
      </label>
      <label css={label} htmlFor="Decimal">
        Decimal
        <input
          css={checkBox}
          type="radio"
          name="encoding"
          id="Decimal"
          onChange={e => {
            if (e.target.checked === true) setEncodeTo("Decimal");
          }}
        />
      </label>
      <p css={encodedStrCSS}>{encodedStr}</p>
    </div>
  );
};
