import {
  ChangeEvent,
  FunctionComponent,
  useEffect,
  useRef,
  useState,
} from "react";
import { toLatin, toUniCode, toDecimal } from "./util";

import { checkBox, encodingInput, label, wrapper } from "./style";

type encoding = "Unicode" | "Latin" | "Decimal";

export const Encoder: FunctionComponent = () => {
  const [encodedStr, setEncodedStr] = useState("Encoded Data here");
  const [encodeTo, setEncodeTo] = useState<encoding>("Unicode");
  const inputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    if (!inputRef.current) return;
    if (encodeTo === "Latin") {
      const encodedData = toLatin(inputRef.current.value);
      setEncodedStr(encodedData);
      return;
    }
    if (encodeTo === "Unicode") {
      const encodedData = toUniCode(inputRef.current.value);
      setEncodedStr(encodedData);
    }
    if (encodeTo === "Decimal") {
      const encodedData = toDecimal(inputRef.current.value);
      setEncodedStr(encodedData);
    }
  }, [encodeTo]);

  const onChangeFunc = (e: ChangeEvent<HTMLInputElement>) => {
    if (encodeTo === "Latin") {
      const encodedData = toLatin(e.target.value);
      setEncodedStr(encodedData);
      return;
    }
    if (encodeTo === "Unicode") {
      const encodedData = toUniCode(e.target.value);
      setEncodedStr(encodedData);
      return;
    }
    if (encodeTo === "Decimal") {
      const encodedData = toDecimal(e.target.value);
      setEncodedStr(encodedData);
    }
  };

  return (
    <div css={wrapper}>
      <h2>encoder</h2>
      <input
        css={encodingInput}
        defaultValue="Type"
        onChange={onChangeFunc}
        ref={inputRef}
      />
      <label css={label} htmlFor="Unicode">
        <input
          css={checkBox}
          type="checkbox"
          name="encoding"
          id="Unicode"
          value="url"
          checked={encodeTo === "Unicode" && true}
          onChange={e => {
            if (e.target.checked === true) setEncodeTo("Unicode");
          }}
        />
        UniCode
      </label>
      <label css={label} htmlFor="Latin">
        <input
          css={checkBox}
          type="checkbox"
          name="encoding"
          id="Latin"
          value="url"
          checked={encodeTo === "Latin" && true}
          onChange={e => {
            if (e.target.checked === true) setEncodeTo("Latin");
          }}
        />
        Latin
      </label>
      <label css={label} htmlFor="Decimal">
        <input
          css={checkBox}
          type="checkbox"
          name="encoding"
          id="Decimal"
          value="url"
          checked={encodeTo === "Decimal" && true}
          onChange={e => {
            if (e.target.checked === true) setEncodeTo("Decimal");
          }}
        />
        Decimal
      </label>
      <p css={encodedStr}>{encodedStr}</p>
    </div>
  );
};
